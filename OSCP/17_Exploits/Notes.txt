Notes
Basic Buffer (stack) Overflow

In a stack based overflow we are try to exploit a poorly written application by inserting, into memory, too many characters for the stack to store. This will cause the instruction pointer (EIP) to be overwritten by the value of our input. 

If we know the postion of the EIP within the stack we can craft an input that will overwrite that value with a pointer that we create. But how do we know how much memory space has been allocated for the initial input? Trial and error OR

Within metasploit-framework/tools we can use pattern-create.rb -l <length of desired bytes for input> to craft an input that can be used to determine the memory allocation space.

Example:
Step 1) For multithreaded applications you cannot just run gdb, you will need to capture the program as it crashes and offload the dump file, use ulimit -c unlimited. Then start the application, get the PID (ps -a <application>) and run gcore <PID> -o <outfile>. Or wait for the application to crash with your input and a core dump file should be created in the running directory of the app.

Step 2) Copy and paste the pattern created with pattern-create.rb into the input of the applicaiton (note: record the length of the pattern that you created). IF a web based applicaiton you can cat the input through a netcat session with cat <file> | nc <IP> <Port>

Step 3) gdp --core=<outfile>, now look at the character inserted at the EIP with "info reg". Now take that character and use the metasploit-framework/tool/pattern-offset.rb -q <character> -l <length of original pattern created>. The output will be the length of the buffer for that application! You should run/crash the application a few time and pay attention to the various pointers to determine if the stack pointers differ. This would be an indication that there is stack randomization protection in place or canaries :( At that point you may have to look for shared libraries that you could exploit.

Step 4) Now that you have your buffer size, time to find some shell code to input. https://www.exploit-db.com/shellcode/ is a good start to find prewritten code. There are also plenty examples in the metasploit framework (/usr/share/framework2/src/shellcode/). Run gcc -c <shellcode.c> to compile and get your <shellcode.o> .

Step 5) Once you have your <shellcode.o> you can run objdump -d <shellcode.o> to extract the binary strings that need to be passed to your application. Prefice all doubles with '\x' to identify them as hex. For example:

\x31\xc0\x31\xd2\xb0\x0b\x52\x66\x68\x2d\x63\x89\xe7\x52\x68\x62\x61\x73\x68\x68\x62\x69\x6e\x2f\x68\x2f\x2f\x2f\x2f\x89
\xe3\x52\xeb\x06\x57\x53\x89\xe1\xcd\x80\xe8\xf5\xff\xff\xff\x63\x61\x74\x20\x2f\x65\x74\x63\x2f\x70\x61\x73\x73\x77\x64\x3b
\x65\x63\x68\x6f\x20\x64\x6f\x5f\x5f\x6e\x65



